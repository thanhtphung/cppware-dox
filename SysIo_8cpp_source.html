<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>c++ gallery: appkit/SysIo.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">c++ gallery
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('SysIo_8cpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SysIo.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Software by Thanh Phung -- thanhtphung@yahoo.com.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * No copyrights. No warranties. No restrictions in reuse.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;netkit/IpAddr.hpp&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;netkit/Paddr.hpp&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;netkit/UdpClient.hpp&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;syskit/Thread.hpp&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;syskit/macros.h&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;appkit-pch.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;appkit/Bool.hpp&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;appkit/Cmd.hpp&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;appkit/CmdLine.hpp&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;appkit/CmdMap.hpp&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;appkit/LogPath.hpp&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;appkit/S32.hpp&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;appkit/SysIo.hpp&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;appkit/U32.hpp&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="crt_8hpp.html">appkit/crt.hpp</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacenetkit.html">netkit</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacesyskit.html">syskit</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> COLON = <span class="charliteral">&#39;:&#39;</span>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> COMMENT_INDICATOR = <span class="charliteral">&#39;#&#39;</span>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> NEW_LINE[] = <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> UNKNOWN_RSP[] = <span class="stringliteral">&quot;: Unknown command. Try \&quot;help\&quot;.\n&quot;</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> IBUF_SIZE = 196608; <span class="comment">//bytes (192k)</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> OBUF_SIZE = 458752; <span class="comment">//bytes (448k)</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ACL_CAP0 = 1; <span class="comment">//IPv4 address ranges</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> LOG_FILE_CAP = 24576; <span class="comment">//commands</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> THREAD_STACK_SIZE = 0; <span class="comment">//bytes, 0=use-default</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;BEGIN_NAMESPACE1(<a class="code" href="namespaceappkit.html">appkit</a>)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;const <span class="keywordtype">char</span> SysIo::LOG_PATH_HI = &#39;z&#39;;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;const <span class="keywordtype">char</span> SysIo::LOG_PATH_LO = &#39;a&#39;;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//! Construct minimal I/O subsystem. The subsystem does not have dedicated agent</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">//! threads to run commands. Take over ownership of the given UdpClient objects</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//! which will be destroyed by SysIo when appropriate.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a4509b3cd7d560c7a29b9456d9590a597">   47</a></span>&#160;<span class="comment"></span><a class="code" href="classappkit_1_1SysIo.html">SysIo</a>::<a class="code" href="classappkit_1_1SysIo.html">SysIo</a>(<a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>* io0, <a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>* io1):</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;ioPort_(),</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;ioAddr_(),</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;ss_()</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;{</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    logMask_ = 0;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    acl_ = <span class="keyword">new</span> <a class="code" href="classnetkit_1_1IpAddrSet.html">IpAddrSet</a>(ACL_CAP0);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    curLog_[0] = stdout;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    curLog_[1] = stdout;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    ibufSize_ = 0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    obufSize_ = 0;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> paddr;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    io0-&gt;getMyAddr(paddr);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    addr_[0] = paddr.addr();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    ioPort_[0].set(static_cast&lt;unsigned int&gt;(paddr.port()) &lt;&lt; 16);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    io1-&gt;getMyAddr(paddr);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    addr_[1] = paddr.addr();</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    ioPort_[1].set(static_cast&lt;unsigned int&gt;(paddr.port()) &lt;&lt; 16);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    map_ = CmdMap::instance();</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    map_-&gt;addRef();</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    io_[0] = io0;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    io_[1] = io1;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    oldCrashCb_ = 0;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    oldCrashArg_ = 0;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    agent_[0] = 0;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    agent_[1] = 0;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">//! Construct I/O subsystem. The subsystem includes two dedicated agent threads</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">//! to run commands. Commands which can be run must implement the Cmd interface.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">//! Allowed options in config: acl, ibufsize, ioaddr, localonly, obufsize, threadstacksize.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a3518a3857688557346226c91ba184714">   84</a></span>&#160;<span class="comment"></span>SysIo::SysIo(<span class="keyword">const</span> <a class="code" href="classappkit_1_1CmdLine.html">CmdLine</a>&amp; config, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> defaultAddr, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> defaultPort):</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;ioPort_(),</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;ioAddr_(defaultAddr, defaultPort),</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;ss_()</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    curLog_[0] = stdout;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    curLog_[1] = stdout;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    logMask_ = LogReq;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="classappkit_1_1SysIo.html#a87b7c7de3eab565875c483d6108f424f">setLogMode</a>(); <span class="comment">//logMask_</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    formAddr(config); <span class="comment">//ioAddr_</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    formAcl(config); <span class="comment">//acl_</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="classappkit_1_1String.html">String</a> optK(<span class="stringliteral">&quot;ibufsize&quot;</span>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    ibufSize_ = <a class="code" href="classappkit_1_1S32.html">S32</a>(config.<a class="code" href="classappkit_1_1CmdLine.html#af42ba8c444477d599f8588fd0bf7801c">opt</a>(optK), IBUF_SIZE <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    optK = <span class="stringliteral">&quot;obufsize&quot;</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    obufSize_ = <a class="code" href="classappkit_1_1S32.html">S32</a>(config.<a class="code" href="classappkit_1_1CmdLine.html#af42ba8c444477d599f8588fd0bf7801c">opt</a>(optK), OBUF_SIZE <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    addr_[0] = 0;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    addr_[1] = 0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    map_ = <a class="code" href="classappkit_1_1CmdMap.html#af388aa57e5f0abbeeb83be527f47395d">CmdMap::instance</a>();</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    map_-&gt;<a class="code" href="classsyskit_1_1RefCounted.html#a7a33d97f7c62f61bd7cc8128f0e10a41">addRef</a>();</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    mkIo(0); <span class="comment">//io_[0]</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    mkIo(1); <span class="comment">//io_[1]</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* dumpPath = Thread::dumpPath();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    Thread::monitorCrash(onCrash, <span class="keyword">this</span>, dumpPath, &amp;oldCrashCb_, &amp;oldCrashArg_);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    optK = <span class="stringliteral">&quot;threadstacksize&quot;</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stackSizeInBytes = <a class="code" href="classappkit_1_1U32.html">U32</a>(config.<a class="code" href="classappkit_1_1CmdLine.html#af42ba8c444477d599f8588fd0bf7801c">opt</a>(optK), THREAD_STACK_SIZE <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">size_t</span> index = 0;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    runArg_t* arg = <span class="keyword">new</span> runArg_t(<span class="keyword">this</span>, index);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    agent_[0] = <span class="keyword">new</span> <a class="code" href="classsyskit_1_1Thread.html">Thread</a>(agentEntry, arg, stackSizeInBytes);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    index = 1;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    arg = <span class="keyword">new</span> runArg_t(<span class="keyword">this</span>, index);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    agent_[1] = <span class="keyword">new</span> <a class="code" href="classsyskit_1_1Thread.html">Thread</a>(agentEntry, arg, stackSizeInBytes);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;SysIo::~SysIo()</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span> (agent_[1] != 0)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        agent_[1]-&gt;<a class="code" href="classsyskit_1_1Thread.html#af9ffc8a4d0bfe09d7d1644d9c99d12c0">killAndWait</a>();</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keyword">delete</span> agent_[1];</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        agent_[0]-&gt;<a class="code" href="classsyskit_1_1Thread.html#af9ffc8a4d0bfe09d7d1644d9c99d12c0">killAndWait</a>();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keyword">delete</span> agent_[0];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* dumpPath = Thread::dumpPath();</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        Thread::monitorCrash(oldCrashCb_, oldCrashArg_, dumpPath);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">delete</span> io_[1];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">delete</span> io_[0];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    map_-&gt;<a class="code" href="classsyskit_1_1RefCounted.html#afe83dbc394af4d8cce6c0c3fe96187cd">rmRef</a>();</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keyword">delete</span> acl_;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">//! Return the current access control list. This is used to restrict remote</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">//! access when remote access is enabled. An empty value allows remote access</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">//! from any client, and a non-empty value allows remote access from only</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">//! addresses in the list.</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a1b500db58ea3e5666b6f729659247b11">  148</a></span>&#160;<span class="comment"></span><a class="code" href="classnetkit_1_1IpAddrSet.html">IpAddrSet</a> <a class="code" href="classappkit_1_1SysIo.html#a1b500db58ea3e5666b6f729659247b11">SysIo::acl</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">return</span> *acl_;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">//! Return one of the effective addresses of the I/O subsystem. Index 0</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">//! identifies a loopback port. Index 1 identifies another loopback port</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">//! if remote access is disabled and an external port if remote access</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">//! is enabled.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a01af8d91b017a9cfb8a1e137342507f6">  161</a></span>&#160;<span class="comment"></span><a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> <a class="code" href="classappkit_1_1SysIo.html#a01af8d91b017a9cfb8a1e137342507f6">SysIo::addr</a>(<span class="keywordtype">size_t</span> index)<span class="keyword"> const</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span><span class="keyword">&gt;</span>(ioPort_[index] &gt;&gt; 16);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> paddr(addr_[index], port);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span> paddr;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">//! Return the desired home address of the I/O subsystem. Use addr(1) to</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">//! get the actual home address of the I/O subsystem.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a6efdf0cfed1fb0a5bbda9986409427f8">  174</a></span>&#160;<span class="comment"></span><a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> <a class="code" href="classappkit_1_1SysIo.html#a6efdf0cfed1fb0a5bbda9986409427f8">SysIo::ioAddr</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">return</span> ioAddr_;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">//! Update home address using the localonly and ioaddr options. The localonly option</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">//! can be used to disable remote access. The ioaddr option specifies how this process</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">//! can be accessed remotely. Return the updated desired home address of the I/O</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">//! subsystem.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#aa2e43838a070197a5a9bd391b3d5bd2a">  187</a></span>&#160;<span class="comment"></span><a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> <a class="code" href="classappkit_1_1SysIo.html#aa2e43838a070197a5a9bd391b3d5bd2a">SysIo::setIoAddr</a>(<span class="keyword">const</span> <a class="code" href="classappkit_1_1CmdLine.html">CmdLine</a>&amp; config)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;{</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> cur;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> paddr1;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">bool</span> moving;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> old(ioAddr_);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        formAddr(config);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        cur = ioAddr_;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        paddr1.setPort(ioPort_[1] &gt;&gt; 16);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        paddr1.setAddr((addr_[1] == 0)? INADDR_LOOPBACK: addr_[1]);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        moving = (old != cur);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// Sending an empty message from agent zero to agent one to start the move.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// Upon receipt, a new server socket using the desired new home address will</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// replace the current one.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (moving)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* msg = 0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordtype">size_t</span> length = 0;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timeoutInMsecs = 0;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        io_[0]-&gt;snd(msg, length, paddr1, timeoutInMsecs);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">return</span> cur;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">//! Return matching client configuration as a string. Index 0 identifies a loopback</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">//! port. Index 1 identifies another loopback port if remote access is disabled and</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">//! an external port if remote access is enabled. The returned string can help</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">//! configure a client like CmdAgent or Messenger.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a3dbd4bc33b128522886db02e2aca5c99">  223</a></span>&#160;<span class="comment"></span><a class="code" href="classappkit_1_1String.html">String</a> <a class="code" href="classappkit_1_1SysIo.html#a3dbd4bc33b128522886db02e2aca5c99">SysIo::clientConfig</a>(<span class="keywordtype">size_t</span> index)<span class="keyword"> const</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="classappkit_1_1String.html">String</a> opts;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> serverAddr(<a class="code" href="classappkit_1_1SysIo.html#a01af8d91b017a9cfb8a1e137342507f6">addr</a>(index));</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="namespaceappkit.html#a4ad8f90e612748f3870978e79c236efe">sprintf</a>(opts, <span class="stringliteral">&quot;cmd --dbuggee=%s --ibufsize=%ld --obufsize=%ld&quot;</span>,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        serverAddr.<a class="code" href="classnetkit_1_1Paddr.html#af64b40368d4a9c73ca75becba8c17b77">toString</a>().<a class="code" href="classappkit_1_1String.html#a04781e737d65f1dd9af2d7acbb6f4e50">ascii</a>(),</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        obufSize_, <span class="comment">//client incoming buffer should match server outgoing buffer</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        ibufSize_); <span class="comment">//client outgoing buffer should match server incoming buffer</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">return</span> opts;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;}</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">//! Return current state as a string.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a18233b89ce3de10158adcd1681ed368f">  239</a></span>&#160;<span class="comment"></span><a class="code" href="classappkit_1_1String.html">String</a> <a class="code" href="classappkit_1_1SysIo.html#a18233b89ce3de10158adcd1681ed368f">SysIo::state</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="classappkit_1_1String.html">String</a> <a class="code" href="classappkit_1_1SysIo.html#a1b500db58ea3e5666b6f729659247b11">acl</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="classappkit_1_1SysIo.html#a6efdf0cfed1fb0a5bbda9986409427f8">ioAddr</a>[Paddr::StrLength + 1];</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* delim = <span class="stringliteral">&quot;,&quot;</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        acl = acl_-&gt;<a class="code" href="classnetkit_1_1IpAddrSet.html#ada34fe35ad98a6a9e3a9643798a765d0">toString</a>(delim);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        ioAddr_.<a class="code" href="classnetkit_1_1Paddr.html#af64b40368d4a9c73ca75becba8c17b77">toString</a>(ioAddr, COLON);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <a class="code" href="classappkit_1_1String.html">String</a> s(<span class="stringliteral">&quot;acl=\&quot;&quot;</span>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    s += <a class="code" href="classappkit_1_1SysIo.html#a1b500db58ea3e5666b6f729659247b11">acl</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    s += <span class="stringliteral">&quot;\&quot;\nioaddr=&quot;</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    s += <a class="code" href="classappkit_1_1SysIo.html#a6efdf0cfed1fb0a5bbda9986409427f8">ioAddr</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    s += NEW_LINE[0];</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>* SysIo::move()</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;{</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>* old = io_[1];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        mkIo(1);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keyword">delete</span> old;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">return</span> io_[1];</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">// Return true if access control list is empty or if it contains given address.</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordtype">bool</span> SysIo::allowAccessFrom(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> srcAddr)<span class="keyword"> const</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordtype">bool</span> yes = (acl_-&gt;<a class="code" href="classnetkit_1_1IpAddrSet.html#a7a7ee28954090e80140e844cc793d75f">numAddrs</a>() == 0) || acl_-&gt;<a class="code" href="classnetkit_1_1IpAddrSet.html#a3c4151ed7d33e352044c9bd04d73db28">contains</a>(srcAddr);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> yes;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">//! Return true if instance was successfully constructed.</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a53a54e28385395cfe73e03f12683159d">  287</a></span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="classappkit_1_1SysIo.html#a53a54e28385395cfe73e03f12683159d">SysIo::isOk</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordtype">bool</span> ok = io_[0]-&gt;<a class="code" href="classnetkit_1_1UdpClient.html#a715faf7ac165484a42dce5b6240ed878">isOk</a>() &amp;&amp; io_[1]-&gt;<a class="code" href="classnetkit_1_1UdpClient.html#a715faf7ac165484a42dce5b6240ed878">isOk</a>();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">return</span> ok;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">//! This method is invoked when a command is about to be run. The method returns</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">//! true/false to allow/disallow the command execution. The default implementation</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">//! provides some logging before returning true.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a53a667b83a186fc0cd1aefab50665478">  299</a></span>&#160;<span class="comment"></span><span class="keywordtype">bool</span> <a class="code" href="classappkit_1_1SysIo.html#a53a667b83a186fc0cd1aefab50665478">SysIo::onReq</a>(<span class="keyword">const</span> <a class="code" href="classappkit_1_1CmdLine.html">CmdLine</a>&amp; req, <span class="keyword">const</span> <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a>&amp; dbugger)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;{</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    Cmd::tag_t&amp; tag = *<span class="keyword">static_cast&lt;</span>Cmd::tag_t*<span class="keyword">&gt;</span>(req.<a class="code" href="classappkit_1_1CmdLine.html#a5e47995a7686813d75235482a69f6fef">tag</a>());</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">bool</span> allowReq = tag.cmd-&gt;allowReq(req, dbugger);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (((logMask_ &amp; LogReq) == 0) &amp;&amp; (!tag.alwaysLogReq))</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">return</span> allowReq;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    tag.rspTail = 0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    std::FILE* log = tag.log;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">bool</span> flushLogEntries = ((logMask_ &amp; FlushLogEntries) != 0);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    logReq(req, dbugger, log, flushLogEntries);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">return</span> allowReq;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordtype">bool</span> SysIo::showUsage(<span class="keyword">const</span> <a class="code" href="classappkit_1_1CmdLine.html">CmdLine</a>&amp; cmdLine, <span class="keyword">const</span> <a class="code" href="classappkit_1_1Cmd.html">Cmd</a>&amp; cmd)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;{</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// Show extended usage if asked.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="classappkit_1_1String.html">String</a> optK(<span class="stringliteral">&quot;??&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="classappkit_1_1Bool.html">Bool</a> giveHelp(cmdLine.<a class="code" href="classappkit_1_1CmdLine.html#af42ba8c444477d599f8588fd0bf7801c">opt</a>(optK), <span class="keyword">false</span> <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (giveHelp)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmdIndex = cmd.<a class="code" href="classappkit_1_1Cmd.html#a31fe2e4d51947139eac23ce3b80851e8">cmdIndex</a>(cmdLine);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* usage = cmd.<a class="code" href="classappkit_1_1Cmd.html#a5b861b17fb2b228d5aa7ef59fcf840a3">usage</a>(cmdIndex);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* xUsage = cmd.<a class="code" href="classappkit_1_1Cmd.html#abdea2de94339498f664df644fe4ead8d">xUsage</a>(cmdIndex);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        cmd.<a class="code" href="classappkit_1_1Cmd.html#ae77529a4942f4f502b739c044eff1aa7">respond</a>(cmdLine, usage, strlen(usage));</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        cmd.<a class="code" href="classappkit_1_1Cmd.html#ae77529a4942f4f502b739c044eff1aa7">respond</a>(cmdLine, xUsage);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// Show usage if asked.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    optK = <span class="stringliteral">&quot;?&quot;</span>;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    giveHelp = Bool(cmdLine.<a class="code" href="classappkit_1_1CmdLine.html#af42ba8c444477d599f8588fd0bf7801c">opt</a>(optK), <span class="keyword">false</span> <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (giveHelp)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmdIndex = cmd.<a class="code" href="classappkit_1_1Cmd.html#a31fe2e4d51947139eac23ce3b80851e8">cmdIndex</a>(cmdLine);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* usage = cmd.<a class="code" href="classappkit_1_1Cmd.html#a5b861b17fb2b228d5aa7ef59fcf840a3">usage</a>(cmdIndex);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        cmd.<a class="code" href="classappkit_1_1Cmd.html#ae77529a4942f4f502b739c044eff1aa7">respond</a>(cmdLine, usage);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// Not asked.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="keywordtype">void</span> SysIo::bind(<a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>&amp; io, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;{</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">bool</span> ok = io.<a class="code" href="classnetkit_1_1UdpClient.html#a3015223050470c0a1d58dc24b8abdb36">bind</a>(addr, port);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">if</span> ((!ok) &amp;&amp; (port != 0))</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        port = 0;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        io.<a class="code" href="classnetkit_1_1UdpClient.html#a3015223050470c0a1d58dc24b8abdb36">bind</a>(addr, port);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">// Form access control list.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keywordtype">void</span> SysIo::formAcl(<span class="keyword">const</span> CmdLine&amp; config)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;{</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    String optK(<span class="stringliteral">&quot;acl&quot;</span>);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keyword">const</span> String* <a class="code" href="classappkit_1_1SysIo.html#a1b500db58ea3e5666b6f729659247b11">acl</a> = config.opt(optK, 0 <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cap = ACL_CAP0;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> (acl == 0)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        acl_ = <span class="keyword">new</span> <a class="code" href="classnetkit_1_1IpAddrSet.html">IpAddrSet</a>(cap);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordtype">char</span> delim = <span class="charliteral">&#39;,&#39;</span>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        acl_ = <span class="keyword">new</span> <a class="code" href="classnetkit_1_1IpAddrSet.html">IpAddrSet</a>(acl-&gt;ascii(), delim, cap);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keywordtype">void</span> SysIo::formAddr(<span class="keyword">const</span> CmdLine&amp; config)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;{</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">// The localonly option is equivalent to &quot;--ioaddr=127.0.0.1:0&quot;.</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    String optK(<span class="stringliteral">&quot;localonly&quot;</span>);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordtype">bool</span> localOnly = Bool(config.opt(optK), <span class="keyword">false</span> <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (localOnly)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        ioAddr_.<a class="code" href="classnetkit_1_1Paddr.html#abc256a123d77a2acf0ace2ff1ec3f444">reset</a>(INADDR_LOOPBACK, 0U);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// If ioaddr is specified, the &quot;a.b.c.d:n&quot; format is more likely than the &quot;a.b.c.d&quot; format.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        optK = <span class="stringliteral">&quot;ioaddr&quot;</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keyword">const</span> String* <a class="code" href="classappkit_1_1SysIo.html#a6efdf0cfed1fb0a5bbda9986409427f8">ioAddr</a> = config.opt(optK, 0 <span class="comment">/*defaultV*/</span>);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">if</span> (ioAddr != 0)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordtype">bool</span> portIsOptional = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordtype">char</span> delim = COLON;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            ioAddr_.<a class="code" href="classnetkit_1_1Paddr.html#abc256a123d77a2acf0ace2ff1ec3f444">reset</a>(ioAddr-&gt;ascii(), delim, portIsOptional);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;}</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="keywordtype">void</span> SysIo::logReq(<span class="keyword">const</span> CmdLine&amp; req, <span class="keyword">const</span> <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a>&amp; dbugger, std::FILE* log, <span class="keywordtype">bool</span> flushLogEntries)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;{</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">// Form timestamp (example: &quot;|10/25/11 15:46:11|10.0.4.82:32510| &quot;).</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keyword">struct </span>tm now;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    time_t t = time(0);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    localtime_s(&amp;now, &amp;t);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordtype">char</span> stamp[32 + Paddr::StrLength + 2];</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">size_t</span> size = strftime(stamp, 32, <span class="stringliteral">&quot;|%c|&quot;</span>, &amp;now);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    size += dbugger.toDigits(stamp + size, COLON);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    stamp[size++] = <span class="charliteral">&#39;|&#39;</span>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    stamp[size++] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// Log timestamp.</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordtype">size_t</span> count = 1;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    std::fwrite(stamp, size, count, log);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// Log request.</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="keyword">const</span> String&amp; cmd = req.asString();</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    size = cmd.byteSize() - 1;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    std::fwrite(cmd.ascii(), size, count, log);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    size = 1;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    std::fwrite(NEW_LINE, size, count, log);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (flushLogEntries)</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        std::fflush(log);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">// Main loop for each of the dedicated command agent threads. Agent zero is accessible</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">// locally only via loopback addressing. Agent one can be accessible remotely if remote</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">// access has not been disabled.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keywordtype">void</span> SysIo::loop(<span class="keywordtype">size_t</span> index)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;{</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* name = (index == 0)? <span class="stringliteral">&quot;-sysio-a&quot;</span>: <span class="stringliteral">&quot;-sysio-b&quot;</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    LogPath logPath(name, LOG_PATH_LO, LOG_PATH_HI);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    curLog_[index] = logPath.curLog();</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="classsyskit_1_1Atomic32.html">Atomic32</a>* ioPort = &amp;ioPort_[index];</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>* io = io_[index];</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordtype">bool</span> loopback = (index == 0) || (ioAddr_.addr() == INADDR_LOOPBACK);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    Cmd::tag_t cmdTag(<span class="keyword">this</span>, io, curLog_[index], ioPort);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    CmdLine req;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    req.setTag(&amp;cmdTag);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">// Wait forever for input commands. For each arriving command, make</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// sure it comes from a legitimate source, and let its handler take</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// over the command execution via the onRun() method.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> src;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    String cmd;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    String defaultCmdName;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cmdCount = 0;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timeoutInMsecs = 0;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">while</span> (!Thread::isTerminating())</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        utf8_t rawCmd[Cmd::MaxCmdLength + 1];</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordtype">int</span> cmdSize = io-&gt;rcv(rawCmd, <span class="keyword">sizeof</span>(rawCmd), src, UdpClient::ETERNITY);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="comment">// Move to a different home. The move request is an empty message sent from</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="comment">// agent zero to agent one. The move is done by replacing the current server</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="comment">// socket w/ a new one using the desired new home address.</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">if</span> (cmdSize == 0)</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">if</span> ((index == 1) &amp;&amp; (src == <a class="code" href="classappkit_1_1SysIo.html#a01af8d91b017a9cfb8a1e137342507f6">addr</a>(0)))</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                io = move();</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                cmdTag.io = io;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                loopback = (ioAddr_.addr() == INADDR_LOOPBACK);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="comment">// Interrupted?</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">// Ignore illegitimate commands.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> ((cmdSize &lt; 0) || (rawCmd[cmdSize - 1] != 0) ||</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            (loopback &amp;&amp; (src.addr() != INADDR_LOOPBACK)) ||</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            ((!loopback) &amp;&amp; (!allowAccessFrom(src.addr()))))</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="comment">// Give standard response to unknown commands.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="comment">// Allow comments to be logged like a no-op command if command logging is enabled.</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        ioPort-&gt;<a class="code" href="classsyskit_1_1Atomic32.html#a84eef87b41d9ccb69bf87ea36d6b41fd">set</a>(ioPort-&gt;<a class="code" href="classsyskit_1_1Atomic32.html#a77d5bd6430e0c898f931e0f706131947">asWord</a>() &amp; 0xffff0000U | src.port()); <span class="comment">//MSB=dbuggee-port, LSB=dbugger-port</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        cmdTag.rspAddr = loopback? INADDR_LOOPBACK: src.addr();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        cmdTag.rspPort = src.port();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        cmd.reset8(rawCmd, cmdSize);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        req = cmd;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keyword">const</span> String* cmdName = req.arg(0, &amp;defaultCmdName);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        cmdTag.cmd = map_-&gt;<a class="code" href="classappkit_1_1CmdMap.html#a4a39ef1f091fc00030f2d3ba4f49db5a">find</a>(cmdName-&gt;ascii(), cmdTag.cmdIndex);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="keywordflow">if</span> (cmdTag.cmd == 0)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            <span class="keywordflow">if</span> ((!cmdName-&gt;empty()) &amp;&amp; (*cmdName-&gt;ascii() == COMMENT_INDICATOR))</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <span class="keywordflow">if</span> ((logMask_ &amp; LogReq) != 0)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                    <span class="keywordtype">bool</span> flushLogEntries = ((logMask_ &amp; FlushLogEntries) != 0);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                    logReq(req, src, cmdTag.log, flushLogEntries);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> emptyRsp = 0;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                io-&gt;snd(&amp;emptyRsp, 1, src, timeoutInMsecs);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                io-&gt;snd((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(cmdName-&gt;ascii()), cmdName-&gt;length(), src, timeoutInMsecs);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                io-&gt;snd((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(UNKNOWN_RSP), <span class="keyword">sizeof</span>(UNKNOWN_RSP), src, timeoutInMsecs);</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="comment">// Give usage if asked.</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">// Give application an opportunity to disallow running the command.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        cmdTag.alwaysLogReq = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        cmdTag.alwaysLogRsp = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordflow">if</span> (showUsage(req, *cmdTag.cmd) || (!<a class="code" href="classappkit_1_1SysIo.html#a53a667b83a186fc0cd1aefab50665478">onReq</a>(req, src)))</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment">// Run command.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="comment">// Give usage if some hints seem helpful.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="keywordflow">if</span> (!cmdTag.cmd-&gt;run(req))</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span>* usage = cmdTag.cmd-&gt;usage(cmdTag.cmdIndex);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            cmdTag.cmd-&gt;respond(req, usage);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordflow">if</span> ((++cmdCount % LOG_FILE_CAP) == 0)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            curLog_[index] = logPath.reopen();</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            cmdTag.log = curLog_[index];</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">// Create socket to serve as channel for command inputs/outputs.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">// Save bound port in MSB of ioPort.</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordtype">void</span> SysIo::mkIo(<span class="keywordtype">size_t</span> index)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;{</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// Determine address to bind to.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classappkit_1_1SysIo.html#a01af8d91b017a9cfb8a1e137342507f6">addr</a>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">if</span> (index == 0)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        addr = INADDR_LOOPBACK;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        port = 0U;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">else</span> <span class="comment">//1</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        addr = ioAddr_.addr();</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        port = ioAddr_.port();</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">// Bind and save effective I/O address.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">// Consider port binding optional.</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>* io = <span class="keyword">new</span> <a class="code" href="classnetkit_1_1UdpClient.html">UdpClient</a>(ibufSize_, obufSize_);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    bind(*io, addr, port);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <a class="code" href="classnetkit_1_1Paddr.html">Paddr</a> myPaddr;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    io-&gt;<a class="code" href="classnetkit_1_1UdpClient.html#a49d159f8860d848a7d7b73c07935b55a">getMyAddr</a>(myPaddr);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    addr_[index] = myPaddr.addr();</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    io_[index] = io;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    ioPort_[index].<a class="code" href="classsyskit_1_1Atomic32.html#a84eef87b41d9ccb69bf87ea36d6b41fd">set</a>(static_cast&lt;unsigned int&gt;(myPaddr.port()) &lt;&lt; 16);</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">// Flush buffered I/O at crash.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="keywordtype">void</span> SysIo::onCrash(<span class="keywordtype">void</span>* arg)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;{</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keyword">const</span> <a class="code" href="classappkit_1_1SysIo.html#a3518a3857688557346226c91ba184714">SysIo</a>* sysIo = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="classappkit_1_1SysIo.html#a3518a3857688557346226c91ba184714">SysIo</a>*<span class="keyword">&gt;</span>(arg);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    std::fflush(sysIo-&gt;curLog_[0]);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    std::fflush(sysIo-&gt;curLog_[1]);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    sysIo-&gt;oldCrashCb_(sysIo-&gt;oldCrashArg_);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">//! This method is invoked when some response has been generated (successful or not).</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">//! The default implementation provides logging of the response if logging is enabled.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a792b3c60e0f8d5d6be3c739ad258cb04">  594</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classappkit_1_1SysIo.html#a792b3c60e0f8d5d6be3c739ad258cb04">SysIo::onRsp</a>(<span class="keyword">const</span> <a class="code" href="classappkit_1_1CmdLine.html">CmdLine</a>&amp; req, <span class="keyword">const</span> <span class="keywordtype">char</span>* rsp, <span class="keywordtype">size_t</span> rspLength, <span class="keywordtype">bool</span> ok)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    Cmd::tag_t&amp; tag = *<span class="keyword">static_cast&lt;</span>Cmd::tag_t*<span class="keyword">&gt;</span>(req.<a class="code" href="classappkit_1_1CmdLine.html#a5e47995a7686813d75235482a69f6fef">tag</a>());</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordflow">if</span> (((logMask_ &amp; LogRsp) == 0) &amp;&amp; (!tag.alwaysLogRsp))</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// Form timestamp (example: &quot;\n|08/28/09 15:46:13|1|\n&quot;).</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">char</span> stamp[1 + 32 + 3];</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* tail = 0;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">size_t</span> tailSize = 0;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">if</span> (rsp[rspLength - 1] == 0)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <span class="keyword">struct </span>tm now;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        time_t t = time(0);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        localtime_s(&amp;now, &amp;t);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        stamp[0] = NEW_LINE[0];</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        tail = stamp;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        tailSize = 1;</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        tailSize += strftime(stamp + 1, 32, <span class="stringliteral">&quot;|%c|&quot;</span>, &amp;now);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        stamp[tailSize++] = ok? <span class="charliteral">&#39;1&#39;</span>: <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        stamp[tailSize++] = <span class="charliteral">&#39;|&#39;</span>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        stamp[tailSize++] = NEW_LINE[0];</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">if</span> (--rspLength &gt; 0)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            <span class="keywordflow">if</span> (rsp[rspLength - 1] == NEW_LINE[0])</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                ++tail;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                --tailSize;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag.rspTail == NEW_LINE[0])</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            ++tail;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            --tailSize;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        tag.rspTail = rsp[rspLength - 1];</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="comment">// Log response without terminating null.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">// Log timestamp at end-of-response.</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    std::FILE* log = tag.log;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordtype">size_t</span> count = 1;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    std::fwrite(rsp, rspLength, count, log);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (tail != 0)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        std::fwrite(tail, tailSize, count, log);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">//! Update the access control list. An empty set allows remote access to all if</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">//! remote access is enabled. A non-empty set allows remote access from only those</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">//! IPv4 addresses in the set.</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00654"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a68955cc30c2c6a5730a15e501c28a769">  654</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classappkit_1_1SysIo.html#a68955cc30c2c6a5730a15e501c28a769">SysIo::setAcl</a>(<span class="keyword">const</span> <a class="code" href="classnetkit_1_1IpAddrSet.html">IpAddrSet</a>&amp; acl)</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;{</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <a class="code" href="classsyskit_1_1SpinSection_1_1Lock.html">SpinSection::Lock</a> lock(ss_);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    *acl_ = <a class="code" href="classappkit_1_1SysIo.html#a1b500db58ea3e5666b6f729659247b11">acl</a>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;}</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">//! Enable/Disable logging. By default, requests are logged and responses are not</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">//! logged. Response logging can be enabled only if request logging is also enabled.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">//! Log entries are buffered and flushed as needed. To flush entries as soon as</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">//! they are logged, set flushLogEntries to true.</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">//!</span></div>
<div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="classappkit_1_1SysIo.html#a87b7c7de3eab565875c483d6108f424f">  667</a></span>&#160;<span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classappkit_1_1SysIo.html#a87b7c7de3eab565875c483d6108f424f">SysIo::setLogMode</a>(<span class="keywordtype">bool</span> logReq, <span class="keywordtype">bool</span> logRsp, <span class="keywordtype">bool</span> flushLogEntries)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;{</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flushMask = flushLogEntries? FlushLogEntries: 0;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> logMask = logReq? (logRsp? (LogReq | LogRsp | flushMask): (LogReq | flushMask)): (flushMask);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (logMask != logMask_)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        logMask_ = logMask;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        std::fflush(curLog_[0]);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        std::fflush(curLog_[1]);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;}</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">// Entry point for each of the dedicated command agent threads.</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="keywordtype">void</span>* SysIo::agentEntry(<span class="keywordtype">void</span>* arg)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;{</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keyword">const</span> runArg_t* runArg = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>runArg_t*<span class="keyword">&gt;</span>(arg);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="classappkit_1_1SysIo.html">SysIo</a>* sysIo = runArg-&gt;sysIo;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordtype">size_t</span> index = runArg-&gt;index;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keyword">delete</span> runArg;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    sysIo-&gt;loop(index);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;}</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;END_NAMESPACE1</div>
<div class="ttc" id="crt_8hpp_html"><div class="ttname"><a href="crt_8hpp.html">crt.hpp</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_aa2e43838a070197a5a9bd391b3d5bd2a"><div class="ttname"><a href="classappkit_1_1SysIo.html#aa2e43838a070197a5a9bd391b3d5bd2a">appkit::SysIo::setIoAddr</a></div><div class="ttdeci">netkit::Paddr setIoAddr(const CmdLine &amp;config)</div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00187">SysIo.cpp:187</a></div></div>
<div class="ttc" id="namespaceappkit_html_a4ad8f90e612748f3870978e79c236efe"><div class="ttname"><a href="namespaceappkit.html#a4ad8f90e612748f3870978e79c236efe">appkit::sprintf</a></div><div class="ttdeci">int sprintf(String &amp;buf, const char *format,...) GCC_ATTR((format(printf</div><div class="ttdef"><b>Definition:</b> <a href="crt-linux_8cpp_source.html#l00117">crt-linux.cpp:117</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a3518a3857688557346226c91ba184714"><div class="ttname"><a href="classappkit_1_1SysIo.html#a3518a3857688557346226c91ba184714">appkit::SysIo::SysIo</a></div><div class="ttdeci">SysIo(const CmdLine &amp;config, unsigned int defaultAddr=INADDR_ANY, unsigned short defaultPort=0U)</div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00084">SysIo.cpp:84</a></div></div>
<div class="ttc" id="classappkit_1_1Cmd_html_a5b861b17fb2b228d5aa7ef59fcf840a3"><div class="ttname"><a href="classappkit_1_1Cmd.html#a5b861b17fb2b228d5aa7ef59fcf840a3">appkit::Cmd::usage</a></div><div class="ttdeci">virtual const char * usage(unsigned char cmdIndex) const </div><div class="ttdef"><b>Definition:</b> <a href="Cmd_8cpp_source.html#l00287">Cmd.cpp:287</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a18233b89ce3de10158adcd1681ed368f"><div class="ttname"><a href="classappkit_1_1SysIo.html#a18233b89ce3de10158adcd1681ed368f">appkit::SysIo::state</a></div><div class="ttdeci">String state() const </div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00239">SysIo.cpp:239</a></div></div>
<div class="ttc" id="classnetkit_1_1Paddr_html"><div class="ttname"><a href="classnetkit_1_1Paddr.html">netkit::Paddr</a></div><div class="ttdoc">IPv4 port address. </div><div class="ttdef"><b>Definition:</b> <a href="Paddr_8hpp_source.html#l00016">Paddr.hpp:16</a></div></div>
<div class="ttc" id="classsyskit_1_1SpinSection_1_1Lock_html"><div class="ttname"><a href="classsyskit_1_1SpinSection_1_1Lock.html">syskit::SpinSection::Lock</a></div><div class="ttdoc">critical section lock </div><div class="ttdef"><b>Definition:</b> <a href="SpinSection_8hpp_source.html#l00057">SpinSection.hpp:57</a></div></div>
<div class="ttc" id="classsyskit_1_1Thread_html_af9ffc8a4d0bfe09d7d1644d9c99d12c0"><div class="ttname"><a href="classsyskit_1_1Thread.html#af9ffc8a4d0bfe09d7d1644d9c99d12c0">syskit::Thread::killAndWait</a></div><div class="ttdeci">bool killAndWait(void **exitCode=0)</div><div class="ttdef"><b>Definition:</b> <a href="Thread_8cpp_source.html#l00081">Thread.cpp:81</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a53a667b83a186fc0cd1aefab50665478"><div class="ttname"><a href="classappkit_1_1SysIo.html#a53a667b83a186fc0cd1aefab50665478">appkit::SysIo::onReq</a></div><div class="ttdeci">virtual bool onReq(const CmdLine &amp;req, const netkit::Paddr &amp;dbugger)</div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00299">SysIo.cpp:299</a></div></div>
<div class="ttc" id="classappkit_1_1Cmd_html_ae77529a4942f4f502b739c044eff1aa7"><div class="ttname"><a href="classappkit_1_1Cmd.html#ae77529a4942f4f502b739c044eff1aa7">appkit::Cmd::respond</a></div><div class="ttdeci">static bool static bool respond(const CmdLine &amp;req, const char *rsp)</div><div class="ttdef"><b>Definition:</b> <a href="Cmd_8cpp_source.html#l00149">Cmd.cpp:149</a></div></div>
<div class="ttc" id="classappkit_1_1String_html_a04781e737d65f1dd9af2d7acbb6f4e50"><div class="ttname"><a href="classappkit_1_1String.html#a04781e737d65f1dd9af2d7acbb6f4e50">appkit::String::ascii</a></div><div class="ttdeci">const char * ascii() const </div><div class="ttdoc">Return the null-terminated ASCII string assuming instance is a 7-bit ASCII string. </div><div class="ttdef"><b>Definition:</b> <a href="String_8hpp_source.html#l00421">String.hpp:421</a></div></div>
<div class="ttc" id="classnetkit_1_1UdpClient_html_a49d159f8860d848a7d7b73c07935b55a"><div class="ttname"><a href="classnetkit_1_1UdpClient.html#a49d159f8860d848a7d7b73c07935b55a">netkit::UdpClient::getMyAddr</a></div><div class="ttdeci">bool getMyAddr(Paddr &amp;addr) const </div><div class="ttdef"><b>Definition:</b> <a href="UdpClient_8cpp_source.html#l00086">UdpClient.cpp:86</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a792b3c60e0f8d5d6be3c739ad258cb04"><div class="ttname"><a href="classappkit_1_1SysIo.html#a792b3c60e0f8d5d6be3c739ad258cb04">appkit::SysIo::onRsp</a></div><div class="ttdeci">virtual void onRsp(const CmdLine &amp;req, const char *rsp, size_t rspLength, bool ok)</div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00594">SysIo.cpp:594</a></div></div>
<div class="ttc" id="classappkit_1_1Cmd_html"><div class="ttname"><a href="classappkit_1_1Cmd.html">appkit::Cmd</a></div><div class="ttdoc">command handler </div><div class="ttdef"><b>Definition:</b> <a href="Cmd_8hpp_source.html#l00026">Cmd.hpp:26</a></div></div>
<div class="ttc" id="classappkit_1_1CmdLine_html_a5e47995a7686813d75235482a69f6fef"><div class="ttname"><a href="classappkit_1_1CmdLine.html#a5e47995a7686813d75235482a69f6fef">appkit::CmdLine::tag</a></div><div class="ttdeci">void * tag() const </div><div class="ttdoc">Return the attached tag. </div><div class="ttdef"><b>Definition:</b> <a href="CmdLine_8hpp_source.html#l00227">CmdLine.hpp:227</a></div></div>
<div class="ttc" id="classnetkit_1_1IpAddrSet_html_a3c4151ed7d33e352044c9bd04d73db28"><div class="ttname"><a href="classnetkit_1_1IpAddrSet.html#a3c4151ed7d33e352044c9bd04d73db28">netkit::IpAddrSet::contains</a></div><div class="ttdeci">bool contains(const IpAddrSet &amp;set) const </div><div class="ttdoc">Return true if this set is identical to or is a superset of given set. </div><div class="ttdef"><b>Definition:</b> <a href="IpAddrSet_8hpp_source.html#l00207">IpAddrSet.hpp:207</a></div></div>
<div class="ttc" id="namespacesyskit_html"><div class="ttname"><a href="namespacesyskit.html">syskit</a></div><div class="ttdef"><b>Definition:</b> <a href="Atomic32_8hpp_source.html#l00010">Atomic32.hpp:10</a></div></div>
<div class="ttc" id="classsyskit_1_1RefCounted_html_afe83dbc394af4d8cce6c0c3fe96187cd"><div class="ttname"><a href="classsyskit_1_1RefCounted.html#afe83dbc394af4d8cce6c0c3fe96187cd">syskit::RefCounted::rmRef</a></div><div class="ttdeci">bool rmRef() const </div><div class="ttdef"><b>Definition:</b> <a href="RefCounted_8cpp_source.html#l00043">RefCounted.cpp:43</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a1b500db58ea3e5666b6f729659247b11"><div class="ttname"><a href="classappkit_1_1SysIo.html#a1b500db58ea3e5666b6f729659247b11">appkit::SysIo::acl</a></div><div class="ttdeci">netkit::IpAddrSet acl() const </div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00148">SysIo.cpp:148</a></div></div>
<div class="ttc" id="classappkit_1_1CmdLine_html_af42ba8c444477d599f8588fd0bf7801c"><div class="ttname"><a href="classappkit_1_1CmdLine.html#af42ba8c444477d599f8588fd0bf7801c">appkit::CmdLine::opt</a></div><div class="ttdeci">const String * opt(const String &amp;optK, const String *defaultV=0) const </div><div class="ttdef"><b>Definition:</b> <a href="CmdLine_8hpp_source.html#l00180">CmdLine.hpp:180</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html"><div class="ttname"><a href="classappkit_1_1SysIo.html">appkit::SysIo</a></div><div class="ttdoc">I/O subsystem. </div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8hpp_source.html#l00028">SysIo.hpp:28</a></div></div>
<div class="ttc" id="namespacenetkit_html"><div class="ttname"><a href="namespacenetkit.html">netkit</a></div><div class="ttdef"><b>Definition:</b> <a href="CapConfig_8cpp_source.html#l00024">CapConfig.cpp:24</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a6efdf0cfed1fb0a5bbda9986409427f8"><div class="ttname"><a href="classappkit_1_1SysIo.html#a6efdf0cfed1fb0a5bbda9986409427f8">appkit::SysIo::ioAddr</a></div><div class="ttdeci">netkit::Paddr ioAddr() const </div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00174">SysIo.cpp:174</a></div></div>
<div class="ttc" id="classnetkit_1_1IpAddrSet_html_ada34fe35ad98a6a9e3a9643798a765d0"><div class="ttname"><a href="classnetkit_1_1IpAddrSet.html#ada34fe35ad98a6a9e3a9643798a765d0">netkit::IpAddrSet::toString</a></div><div class="ttdeci">virtual appkit::String toString(const char *delim=&quot;,&quot;) const </div><div class="ttdef"><b>Definition:</b> <a href="IpAddrSet_8cpp_source.html#l00100">IpAddrSet.cpp:100</a></div></div>
<div class="ttc" id="classsyskit_1_1Thread_html"><div class="ttname"><a href="classsyskit_1_1Thread.html">syskit::Thread</a></div><div class="ttdoc">thread (aka task) </div><div class="ttdef"><b>Definition:</b> <a href="Thread_8hpp_source.html#l00016">Thread.hpp:16</a></div></div>
<div class="ttc" id="classappkit_1_1CmdMap_html_a4a39ef1f091fc00030f2d3ba4f49db5a"><div class="ttname"><a href="classappkit_1_1CmdMap.html#a4a39ef1f091fc00030f2d3ba4f49db5a">appkit::CmdMap::find</a></div><div class="ttdeci">Cmd * find(const char *name) const </div><div class="ttdef"><b>Definition:</b> <a href="CmdMap_8hpp_source.html#l00101">CmdMap.hpp:101</a></div></div>
<div class="ttc" id="classnetkit_1_1Paddr_html_af64b40368d4a9c73ca75becba8c17b77"><div class="ttname"><a href="classnetkit_1_1Paddr.html#af64b40368d4a9c73ca75becba8c17b77">netkit::Paddr::toString</a></div><div class="ttdeci">appkit::String toString(char delim= ':') const </div><div class="ttdef"><b>Definition:</b> <a href="Paddr_8hpp_source.html#l00194">Paddr.hpp:194</a></div></div>
<div class="ttc" id="classnetkit_1_1UdpClient_html_a3015223050470c0a1d58dc24b8abdb36"><div class="ttname"><a href="classnetkit_1_1UdpClient.html#a3015223050470c0a1d58dc24b8abdb36">netkit::UdpClient::bind</a></div><div class="ttdeci">bool bind(unsigned int addr, unsigned short port=0U)</div><div class="ttdef"><b>Definition:</b> <a href="UdpClient_8cpp_source.html#l00073">UdpClient.cpp:73</a></div></div>
<div class="ttc" id="classappkit_1_1Cmd_html_a31fe2e4d51947139eac23ce3b80851e8"><div class="ttname"><a href="classappkit_1_1Cmd.html#a31fe2e4d51947139eac23ce3b80851e8">appkit::Cmd::cmdIndex</a></div><div class="ttdeci">static unsigned char cmdIndex(const CmdLine &amp;req)</div><div class="ttdef"><b>Definition:</b> <a href="Cmd_8hpp_source.html#l00170">Cmd.hpp:170</a></div></div>
<div class="ttc" id="classsyskit_1_1Atomic32_html_a77d5bd6430e0c898f931e0f706131947"><div class="ttname"><a href="classsyskit_1_1Atomic32.html#a77d5bd6430e0c898f931e0f706131947">syskit::Atomic32::asWord</a></div><div class="ttdeci">item_t asWord() const </div><div class="ttdoc">Return the unsigned int value. </div><div class="ttdef"><b>Definition:</b> <a href="Atomic32_8hpp_source.html#l00089">Atomic32.hpp:89</a></div></div>
<div class="ttc" id="classnetkit_1_1IpAddrSet_html_a7a7ee28954090e80140e844cc793d75f"><div class="ttname"><a href="classnetkit_1_1IpAddrSet.html#a7a7ee28954090e80140e844cc793d75f">netkit::IpAddrSet::numAddrs</a></div><div class="ttdeci">unsigned long long numAddrs() const </div><div class="ttdoc">Return the current number of addresses in this set. </div><div class="ttdef"><b>Definition:</b> <a href="IpAddrSet_8hpp_source.html#l00290">IpAddrSet.hpp:290</a></div></div>
<div class="ttc" id="namespaceappkit_html"><div class="ttname"><a href="namespaceappkit.html">appkit</a></div><div class="ttdef"><b>Definition:</b> <a href="App-0_8cpp_source.html#l00010">App-0.cpp:10</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a68955cc30c2c6a5730a15e501c28a769"><div class="ttname"><a href="classappkit_1_1SysIo.html#a68955cc30c2c6a5730a15e501c28a769">appkit::SysIo::setAcl</a></div><div class="ttdeci">void setAcl(const netkit::IpAddrSet &amp;acl)</div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00654">SysIo.cpp:654</a></div></div>
<div class="ttc" id="classappkit_1_1CmdMap_html_af388aa57e5f0abbeeb83be527f47395d"><div class="ttname"><a href="classappkit_1_1CmdMap.html#af388aa57e5f0abbeeb83be527f47395d">appkit::CmdMap::instance</a></div><div class="ttdeci">static CmdMap * instance()</div><div class="ttdef"><b>Definition:</b> <a href="CmdMap_8cpp_source.html#l00071">CmdMap.cpp:71</a></div></div>
<div class="ttc" id="classappkit_1_1String_html"><div class="ttname"><a href="classappkit_1_1String.html">appkit::String</a></div><div class="ttdoc">UTF-capable copy-on-write string. </div><div class="ttdef"><b>Definition:</b> <a href="String_8hpp_source.html#l00023">String.hpp:23</a></div></div>
<div class="ttc" id="classappkit_1_1U32_html"><div class="ttname"><a href="classappkit_1_1U32.html">appkit::U32</a></div><div class="ttdoc">unsigned 32-bit number </div><div class="ttdef"><b>Definition:</b> <a href="U32_8hpp_source.html#l00015">U32.hpp:15</a></div></div>
<div class="ttc" id="classnetkit_1_1UdpClient_html_a715faf7ac165484a42dce5b6240ed878"><div class="ttname"><a href="classnetkit_1_1UdpClient.html#a715faf7ac165484a42dce5b6240ed878">netkit::UdpClient::isOk</a></div><div class="ttdeci">virtual bool isOk() const </div><div class="ttdef"><b>Definition:</b> <a href="UdpClient_8cpp_source.html#l00112">UdpClient.cpp:112</a></div></div>
<div class="ttc" id="classnetkit_1_1IpAddrSet_html"><div class="ttname"><a href="classnetkit_1_1IpAddrSet.html">netkit::IpAddrSet</a></div><div class="ttdoc">set of IPv4 addresses </div><div class="ttdef"><b>Definition:</b> <a href="IpAddrSet_8hpp_source.html#l00015">IpAddrSet.hpp:15</a></div></div>
<div class="ttc" id="classappkit_1_1S32_html"><div class="ttname"><a href="classappkit_1_1S32.html">appkit::S32</a></div><div class="ttdoc">signed 32-bit number </div><div class="ttdef"><b>Definition:</b> <a href="S32_8hpp_source.html#l00015">S32.hpp:15</a></div></div>
<div class="ttc" id="classnetkit_1_1Paddr_html_abc256a123d77a2acf0ace2ff1ec3f444"><div class="ttname"><a href="classnetkit_1_1Paddr.html#abc256a123d77a2acf0ace2ff1ec3f444">netkit::Paddr::reset</a></div><div class="ttdeci">bool reset(const char *s, char delim= ':', bool portIsOptional=false)</div><div class="ttdef"><b>Definition:</b> <a href="Paddr_8cpp_source.html#l00106">Paddr.cpp:106</a></div></div>
<div class="ttc" id="classsyskit_1_1Atomic32_html"><div class="ttname"><a href="classsyskit_1_1Atomic32.html">syskit::Atomic32</a></div><div class="ttdoc">atomic 32-bit number </div><div class="ttdef"><b>Definition:</b> <a href="Atomic32_8hpp_source.html#l00014">Atomic32.hpp:14</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a87b7c7de3eab565875c483d6108f424f"><div class="ttname"><a href="classappkit_1_1SysIo.html#a87b7c7de3eab565875c483d6108f424f">appkit::SysIo::setLogMode</a></div><div class="ttdeci">void setLogMode(bool logReq=true, bool logRsp=false, bool flushLogEntries=false)</div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00667">SysIo.cpp:667</a></div></div>
<div class="ttc" id="classsyskit_1_1Atomic32_html_a84eef87b41d9ccb69bf87ea36d6b41fd"><div class="ttname"><a href="classsyskit_1_1Atomic32.html#a84eef87b41d9ccb69bf87ea36d6b41fd">syskit::Atomic32::set</a></div><div class="ttdeci">void set(item_t v)</div><div class="ttdoc">Reset instance with given value. </div><div class="ttdef"><b>Definition:</b> <a href="Atomic32-linux_8hpp_source.html#l00259">Atomic32-linux.hpp:259</a></div></div>
<div class="ttc" id="classnetkit_1_1UdpClient_html"><div class="ttname"><a href="classnetkit_1_1UdpClient.html">netkit::UdpClient</a></div><div class="ttdoc">udp socket </div><div class="ttdef"><b>Definition:</b> <a href="UdpClient-linux_8hpp_source.html#l00013">UdpClient-linux.hpp:13</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a3dbd4bc33b128522886db02e2aca5c99"><div class="ttname"><a href="classappkit_1_1SysIo.html#a3dbd4bc33b128522886db02e2aca5c99">appkit::SysIo::clientConfig</a></div><div class="ttdeci">String clientConfig(size_t index) const </div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00223">SysIo.cpp:223</a></div></div>
<div class="ttc" id="classappkit_1_1Cmd_html_abdea2de94339498f664df644fe4ead8d"><div class="ttname"><a href="classappkit_1_1Cmd.html#abdea2de94339498f664df644fe4ead8d">appkit::Cmd::xUsage</a></div><div class="ttdeci">virtual const char * xUsage(unsigned char cmdIndex) const </div><div class="ttdef"><b>Definition:</b> <a href="Cmd_8cpp_source.html#l00307">Cmd.cpp:307</a></div></div>
<div class="ttc" id="classappkit_1_1Bool_html"><div class="ttname"><a href="classappkit_1_1Bool.html">appkit::Bool</a></div><div class="ttdoc">boolean value </div><div class="ttdef"><b>Definition:</b> <a href="Bool_8hpp_source.html#l00015">Bool.hpp:15</a></div></div>
<div class="ttc" id="classappkit_1_1CmdLine_html"><div class="ttname"><a href="classappkit_1_1CmdLine.html">appkit::CmdLine</a></div><div class="ttdoc">command line </div><div class="ttdef"><b>Definition:</b> <a href="CmdLine_8hpp_source.html#l00017">CmdLine.hpp:17</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a01af8d91b017a9cfb8a1e137342507f6"><div class="ttname"><a href="classappkit_1_1SysIo.html#a01af8d91b017a9cfb8a1e137342507f6">appkit::SysIo::addr</a></div><div class="ttdeci">netkit::Paddr addr(size_t index) const </div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00161">SysIo.cpp:161</a></div></div>
<div class="ttc" id="classsyskit_1_1RefCounted_html_a7a33d97f7c62f61bd7cc8128f0e10a41"><div class="ttname"><a href="classsyskit_1_1RefCounted.html#a7a33d97f7c62f61bd7cc8128f0e10a41">syskit::RefCounted::addRef</a></div><div class="ttdeci">void addRef() const </div><div class="ttdef"><b>Definition:</b> <a href="RefCounted_8hpp_source.html#l00096">RefCounted.hpp:96</a></div></div>
<div class="ttc" id="classappkit_1_1SysIo_html_a53a54e28385395cfe73e03f12683159d"><div class="ttname"><a href="classappkit_1_1SysIo.html#a53a54e28385395cfe73e03f12683159d">appkit::SysIo::isOk</a></div><div class="ttdeci">bool isOk() const </div><div class="ttdef"><b>Definition:</b> <a href="SysIo_8cpp_source.html#l00287">SysIo.cpp:287</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_9bfcdac1e1e2135fd828ac02115397e6.html">appkit</a></li><li class="navelem"><b>SysIo.cpp</b></li>
    <li class="footer">Generated on Sat Sep 6 2014 06:58:58 for c++ gallery by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
